<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>A to Z — Daily Work (Two-Line • Header Slider v3.9)</title>
  <meta name="description" content="Daily Work Entry with Mode, Future Summary, delete, alarms, and header slider for tasks due tomorrow.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary:'#FF6F00', dark:'#0F172A', light:'#F8FAFC', accent:'#1E40AF' },
          boxShadow: { soft: '0 10px 24px rgba(0,0,0,0.12)' },
          keyframes: {
            slideIn: { '0%':{transform:'translateX(30px)',opacity:'0'}, '100%':{transform:'translateX(0)',opacity:'1'} },
            ticker: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } }
          },
          animation: {
            slideIn: 'slideIn .35s ease-out',
            ticker: 'ticker 8s linear infinite'
          }
        }
      }
    };
  </script>
  <style>
    body { font-weight: 600; }
    .bar { width:100%; border-radius:1rem; border:4px solid #0F172A; padding:1rem 1.25rem; outline:none }
    .bar:focus { box-shadow: 0 0 0 6px rgba(255,111,0,.25); }
    .label { font-size:.85rem; color:#64748b; font-weight:700; }
    .btn { border-radius:1rem; padding:.9rem 1.1rem; font-size:1rem; font-weight:800 }
    .btn-outline { border:4px solid #0F172A; background:white }
    .btn-primary { background:#FF6F00; color:white }
    @media (max-width:640px){
      .tight-grid { display:grid; grid-template-columns:1fr; gap:.75rem }
      .row-actions { display:grid; grid-template-columns:1fr 1fr; gap:.5rem }
    }
    @media (min-width:641px){
      .tight-grid { display:grid; grid-template-columns: repeat(12, minmax(0,1fr)); gap:.75rem; align-items:end }
      .col-2 { grid-column: span 2 / span 2 }
      .col-3 { grid-column: span 3 / span 3 }
      .col-4 { grid-column: span 4 / span 4 }
    }
    .card { border:2px solid #e5e7eb; border-radius:1rem; padding:1rem; background:white }
    .ticker-wrap { overflow:hidden; white-space:nowrap; }
    .ticker-item { display:inline-block; padding-right:2rem; }
    .ticker-link { text-decoration: underline; }
  </style>
</head>
<body class="bg-light text-dark min-h-screen flex flex-col">
  <!-- Header: normal -->
  <header id="headerNormal" class="bg-primary text-white shadow-soft">
    <div class="max-w-6xl mx-auto px-4 py-5 flex items-center justify-between">
      <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">DAILY WORK — TWO-LINE ENTRY</h1>
      <div class="text-right leading-tight text-sm sm:text-base">
        <div class="text-white/90">WhatsApp: <span class="font-black">+91 89176 05258</span></div>
        <div class="text-white/80">Group: <span class="font-black">Daily Group</span></div>
      </div>
    </div>
  </header>

  <!-- Header: ticker shown when there are items due tomorrow -->
  <header id="headerTicker" class="hidden bg-primary text-white shadow-soft">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between mb-1">
        <div class="text-lg sm:text-2xl font-extrabold">⏰ Due Tomorrow — Sliding Tasks</div>
        <button id="exitTicker" class="btn btn-outline bg-white/10 text-white">Close</button>
      </div>
      <div id="tickerWrap" class="ticker-wrap">
        <div id="ticker" class="animate-ticker"></div>
      </div>
      <div class="text-xs sm:text-sm opacity-90 mt-1">Tap a sliding item to open WhatsApp message for that task.</div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto w-full px-4 py-8 space-y-6 flex-1">
    <!-- ENTRY FORM -->
    <section id="entrySection" class="bg-white rounded-3xl shadow-soft border-2 border-primary p-4 sm:p-6">
      <div class="mb-4">
        <label for="title" class="block text-xl mb-2">One-line Entry (Title / Details) <span class="text-red-500">*</span></label>
        <input id="title" class="bar text-base sm:text-lg" autocomplete="off" autocapitalize="sentences" spellcheck="true">
      </div>
      <div class="tight-grid">
        <div class="col-3">
          <div class="label mb-1">Assignee *</div>
          <select id="assignee" class="bar text-lg py-3">
            <option value="">Select</option>
            <option>Banani Ma’am</option>
            <option>Srinivas</option>
            <option>Farhatun</option>
            <option>Sarkar Sir</option>
            <option>Zafir</option>
            <option>Rao Babu</option>
          </select>
        </div>
        <div class="col-3">
          <div class="label mb-1">Planned Date *</div>
          <input id="plannedDate" type="date" class="bar text-lg py-3">
        </div>
        <div class="col-4">
          <div class="label mb-1">End Time</div>
          <input id="endTime" type="time" class="bar text-lg py-3" placeholder="HH:MM">
        </div>
        <div class="col-2">
          <div class="label mb-1">Mode *</div>
          <select id="mode" class="bar text-lg py-3">
            <option value="">Select</option>
            <option>Urgent</option>
            <option>Today</option>
            <option>Future</option>
            <option>Package</option>
          </select>
        </div>
        <div class="col-2 row-actions flex gap-2">
          <button id="btnSave" class="btn btn-primary w-full">SAVE & SHARE</button>
          <button id="btnClear" class="btn btn-outline w-full">CLEAR</button>
        </div>
      </div>
    </section>

    <!-- FUTURE SUMMARY -->
    <section class="max-w-6xl mx-auto w-full space-y-4">
      <div id="dueTomorrowBanner" class="hidden card border-primary">
        <div class="text-lg font-extrabold mb-1">⏰ Due Tomorrow</div>
        <div id="tomorrowList" class="text-sm"></div>
      </div>
      <div class="card">
        <div class="text-lg font-extrabold mb-2">Future Summary (by planned date)</div>
        <div id="futureList" class="text-sm"></div>
      </div>
    </section>
  </main>

  <footer class="bg-dark text-white mt-8">
    <div class="max-w-6xl mx-auto px-4 py-6 flex items-center justify-between">
      <div class="text-2xl font-extrabold tracking-tight">A to Z Packers & Movers</div>
      <div class="text-lg">© <span id="year"></span> • Two-Line Entry</div>
    </div>
  </footer>

  <script>
    const WA_NUMBER = '918917605258'; // +91 8917605258
    const STORAGE_MAIN = 'a2z-mode-entries-v39';
    const STORAGE_WA = 'a2z-mode-waqueue-v39';
    const STORAGE_FUTURE = 'a2z-mode-future-v39';

    const $ = (id) => document.getElementById(id);
    function saveLocal(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
    function readLocal(key, fallback){ try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; } }

    // WhatsApp text: REAL newline characters and NO colons after bold labels
    function toWA(e){
      const lines = [
        `*Title* ${e.title}`,
        `*Mode* ${e.mode}`,
        `*Assignee* ${e.assignee}`,
        `*End Time* ${e.endTime || '-'}`,
        `*Planned* ${e.plannedDate}`
      ];
      const text = lines.join('\n'); // ← we will replace this with a real newline below to avoid '/n'
      // Replace literal backslash-n sequences with real newline char
      const realNewlineText = text.replace(/\\n/g, '\n');
      return encodeURIComponent(realNewlineText);
    }

    function validate(data){
      const missing = [];
      if(!data.title) missing.push('Title/Details');
      if(!data.mode) missing.push('Mode');
      if(!data.assignee) missing.push('Assignee');
      if(!data.plannedDate) missing.push('Planned Date');
      if(missing.length){ alert('Please provide: ' + missing.join(', ')); return false; }
      return true;
    }

    function saveEntry(data){
      const all = readLocal(STORAGE_MAIN, []);
      const id = all.length ? Math.max(...all.map(x=>x.id))+1 : 1;
      const rec = { id, ...data, createdAt: new Date().toISOString() };
      all.push(rec);
      saveLocal(STORAGE_MAIN, all);

      const waq = readLocal(STORAGE_WA, []);
      waq.push({ id, text: decodeURIComponent(toWA(rec)), sent:false });
      saveLocal(STORAGE_WA, waq);

      if(data.mode === 'Future'){
        const f = readLocal(STORAGE_FUTURE, {});
        const key = data.plannedDate;
        if(!f[key]) f[key] = [];
        f[key].push(rec);
        saveLocal(STORAGE_FUTURE, f);
        renderFuture();
        updateHeaderSlider();
      }
      return rec;
    }

    function todayISO(){ return new Date().toISOString().slice(0,10); }
    function tomorrowISO(){ const d=new Date(); d.setDate(d.getDate()+1); return d.toISOString().slice(0,10); }

    function buildItemRow(it){
      const timeStr = it.endTime ? ` • End ${it.endTime}` : '';
      const waURL = `https://wa.me/${WA_NUMBER}?text=${toWA(it)}`;
      return `<div class="flex items-center justify-between gap-2 py-1" data-id="${it.id}" data-date="${it.plannedDate}">
        <div>
          <div><b>${it.title}</b>${timeStr}</div>
          <div class="text-gray-600 text-xs">Assignee: ${it.assignee} • Mode: ${it.mode}</div>
        </div>
        <div class="flex gap-1">
          <a class="btn btn-primary text-xs" href="${waURL}" target="_blank" rel="noopener">WhatsApp</a>
          <button class="btn btn-outline text-xs deleteBtn">Delete</button>
        </div>
      </div>`;
    }

    function renderFuture(){
      const cont = $('futureList');
      const f = readLocal(STORAGE_FUTURE, {});
      const keys = Object.keys(f);
      const today = todayISO();
      const tomorrow = tomorrowISO();

      if(!keys.length){ cont.innerHTML = '<div class="text-gray-500">No future items saved.</div>'; }
      else {
        const dates = keys.sort((a,b)=>{
          const rank = (d)=> d===today ? 0 : (d===tomorrow ? 1 : 2);
          const ra = rank(a), rb = rank(b);
          if(ra!==rb) return ra - rb;
          return a.localeCompare(b);
        });
        cont.innerHTML = dates.map(d => {
          const items = f[d].map(it => buildItemRow(it)).join('');
          const groupClass = (d===today) ? 'border-primary' : '';
          return `<div class="mb-3 card ${groupClass}">
            <div class="font-bold text-base">${d}</div>
            <div class="divide-y">${items}</div>
          </div>`;
        }).join('');
      }

      const tBox = $('dueTomorrowBanner');
      const tList = $('tomorrowList');
      if(f[tomorrow] && f[tomorrow].length){
        tBox.classList.remove('hidden');
        tList.innerHTML = f[tomorrow].map(it => buildItemRow(it)).join('');
      } else {
        tBox.classList.add('hidden');
        tList.innerHTML = '';
      }
    }

    document.addEventListener('click', function(e){
      if(e.target.classList.contains('deleteBtn')){
        const row = e.target.closest('[data-id]');
        const id = parseInt(row.getAttribute('data-id'));
        const dateKey = row.getAttribute('data-date');
        const f = readLocal(STORAGE_FUTURE, {});
        if(f[dateKey]){
          f[dateKey] = f[dateKey].filter(item => item.id !== id);
          if(f[dateKey].length === 0) delete f[dateKey];
          saveLocal(STORAGE_FUTURE, f);
          renderFuture();
          updateHeaderSlider();
        }
      }
    });

    function updateHeaderSlider(){
      const f = readLocal(STORAGE_FUTURE, {});
      const tomorrow = tomorrowISO();
      const items = f[tomorrow] || [];
      const hasItems = items.length > 0;
      $('headerNormal').classList.toggle('hidden', hasItems);
      $('headerTicker').classList.toggle('hidden', !hasItems);
      if(!hasItems){ return; }
      const ticker = $('ticker');
      ticker.innerHTML = items.map(it => {
        const parts = [`${it.plannedDate}`, it.title, it.assignee];
        if(it.endTime) parts.push(it.endTime);
        const label = parts.join(' • ');
        const waURL = `https://wa.me/${WA_NUMBER}?text=${toWA(it)}`;
        return `<span class="ticker-item"><a class="ticker-link" href="${waURL}" target="_blank" rel="noopener">${label}</a></span>`;
      }).join('');
      ticker.classList.remove('animate-ticker'); void ticker.offsetWidth; ticker.classList.add('animate-ticker');
    }

    $('exitTicker').addEventListener('click', () => {
      $('headerTicker').classList.add('hidden');
      $('headerNormal').classList.remove('hidden');
    });

    function handleSave(){
      const data = {
        title: $('title').value.trim(),
        mode: $('mode').value,
        assignee: $('assignee').value,
        plannedDate: $('plannedDate').value,
        endTime: $('endTime').value || null
      };
      if(!validate(data)) return;
      const rec = saveEntry(data);
      const waURL = `https://wa.me/${WA_NUMBER}?text=${toWA(rec)}`;
      window.open(waURL, '_blank');
      $('title').value=''; $('assignee').value=''; $('plannedDate').valueAsDate = new Date(); $('endTime').value=''; $('mode').value='';
    }

    document.addEventListener('DOMContentLoaded', () => {
      $('year').textContent = new Date().getFullYear();
      $('plannedDate').valueAsDate = new Date();
      $('btnSave').addEventListener('click', handleSave);
      $('btnClear').addEventListener('click', () => {
        $('title').value=''; $('assignee').value=''; $('mode').value='';
        $('plannedDate').valueAsDate = new Date(); $('endTime').value='';
      });
      renderFuture();
      updateHeaderSlider();
      setInterval(() => { renderFuture(); updateHeaderSlider(); }, 60*60*1000);
    });
  </script>
</body>
</html>
